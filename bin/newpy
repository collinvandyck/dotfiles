#!/usr/bin/env bash

set -euo pipefail

# https://realpython.com/python-typer-cli/

name=${1:-}
dir=~/code

usage() {
	echo "usage: $(basename "$0") [name]"
	exit 1
}

if [ -z "$name" ]; then
	name=wip
	dir=$(mktemp -d)
fi

cd "$dir"

if [ -d "$name" ]; then
	echo "error: $name already exists"
	exit 1
fi

uv init "$name"
cd "$name"
uv add --dev pytest

cat <<eos > main.py
def greet(name="World"):
    return f"Hello, {name}!"

def main():
    print(greet())

if __name__ == "__main__":
    main()
eos

cat <<eos > test_main.py
from main import greet

def test_greet_default():
    assert greet() == "Hello, World!"

def test_greet_with_name():
    assert greet("Collin") == "Hello, Collin!"

def test_greet_type():
    assert isinstance(greet(), str)
eos

cat <<eos > .justfile
run:
	@uv run python main.py

test:
	@uv run pytest
eos

nvim main.py
exec zsh
