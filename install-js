#!/usr/bin/env bash

set -euo pipefail

# shellcheck source=bin/load-versions
source "$(dirname "$0")/bin/load-versions"

# Parse comma-separated node versions into array
IFS=',' read -ra node_versions <<< "$DOTFILES_NODE_VERSION"

get-nvm-version() {
	if [ -d ~/.nvm ]; then
        (cd ~/.nvm && git describe --tags)
	fi
}

if ! [ "$(get-nvm-version)" = "$DOTFILES_NVM_VERSION" ]; then
	curl -o- "https://raw.githubusercontent.com/nvm-sh/nvm/${DOTFILES_NVM_VERSION}/install.sh" | bash
else
	echo "nvm ${DOTFILES_NVM_VERSION} already installed"
fi

# shellcheck source=/dev/null.
source ~/.nvm/nvm.sh

for nv in "${node_versions[@]}"; do
	nvm install "$nv"
done

nvm alias default 22.17.1

npm install --global yarn

# https://rustwasm.github.io/docs/book/game-of-life/setup.html
# npm install npm@latest -g
